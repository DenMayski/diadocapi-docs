Полка документов
================

**Полка документов** — временное хранилище содержимого документов в Диадоке. Полка используется для удобства передачи и получения содержимого методами API.

Преимущества полки
------------------

Некоторые методы API требуют передавать в них содержимое документов. Но содержимое может быть большим, что вызовет проблемы при его загрузке одной командой. Такая команда будет выполняться долго и даже может завершиться неуспехом.

Для решения этой проблемы используется полка документов. Она позволяет загрузить содержимое документа в хранилище небольшими частями, а после передавать в методы ссылку на содержимое — **имя документа**. Таким образом, в методы можно передавать не содержимое документа, а только его имя на полке. Это ускоряет работу метода и повышает его надежность.

Одно и то же содержимое документа, хранящееся на полке, можно использовать в разных методах. Для этого не придется в каждый метод загружать содержимое документа, достаточно будет указать его имя на полке.

Использование
-------------

Полка предоставляет возможность загружать, хранить и скачивать содержимое документов. Для этого в API реализованы следующие методы:

- Метод :doc:`../http/ShelfUpload` используется для загрузки содержимого на полку документов.

 С помощью этого метода можно загрузить содержимое документов по частям и присвоить ему имя на полке. Если во время загрузки какой-то части возникнут проблемы, метод сообщит об этом.

- Метод :doc:`../http/ShelfDownload` используется для скачивания содержимого документа с полки.

 Для скачивания содержимого нужно знать его имя на полке.

Полка является приоритетным методом передачи данных в методы API. Уже при размере содержимого документа от 500 Кб мы рекомендуем использовать полку, а не передавать его в методы напрямую.

Особенности
-----------

Обращение к данным, хранящимся на полке, осуществляется с помощью имени документа. Это имя нужно присвоить документу при вызове метода загрузки содержимого на полку. Впоследствии это имя используется в других методах API.

Пространство имен документов на полке делится на локальное для пользователя и публичное.

По умолчанию при загрузке на полку имя документа будет публичным. То есть если вызвать метод ``ShelfUpload`` с параметром ``nameOnShelf = xyz``, то имя загруженного документа будет публичным: ``public/xyz``.

Чтобы загрузить документ с локальным именем, при вызове метода ``ShelfUpload`` нужно указать в качестве параметра ``nameOfShelf`` значение ``_userId_/xyz``,  где ``_userId_`` — это строковый литерал. Тогда документ будет загружен на полку с именем ``user_private_files/{userId}/xyz``, значение ``{userId}`` будет взято из текущего авторизационного токена. Доступ к таким файлам можно получить с помощью метода ``ShelfDownload``, указав параметр ``nameOnShelf = __userId__/xyz``.

Методы :doc:`PostMessage` и :doc:`PostMessagePatch` трактуют переданное имя документа как локальное для пользователя, поэтому дописывают в начало имени префикс ``user_private_files/{userId}``. В этих методах имя файла нужно указывать без префикса ``userId``.

Ограничения
-----------

- Нельзя загрузить на полку содержимое документа размером больше 400 Мб.
- Полка используется только для временного хранения данных. Загруженный документ хранится на полке 30 дней.

Представление в API
-------------------

*Методы для работы с полкой:*
	- :doc:`../http/ShelfUpload` — загружает содержимое документа на полку.
	- :doc:`../http/ShelfDownload` — скачивает содержимое документа с полки.